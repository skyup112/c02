<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>κ°μΈνμ› λ§μ΄νμ΄μ§€</title>
    <style>
        .container { display: flex; }
        .sidebar { width: 200px; background-color: #f2f2f2; padding: 20px; height: 100vh; }
        .sidebar a { display: block; margin-bottom: 10px; text-decoration: none; }
        .content { flex: 1; padding: 20px; }
        .nav-top { background-color: #e9e9e9; padding: 10px; }
        .red-text { color: red; }
    </style>
</head>
<body>
<div class="nav-top">
    <a th:href="@{/member/main}">π  λ©”μΈμΌλ΅</a>
</div>
<div class="container">
    <div class="sidebar">
        <strong>π“ λ§μ΄νμ΄μ§€ λ©”λ‰΄</strong>
        <a href="#" onclick="showSection('info')">νμ› μ •λ³΄</a>
        <a href="#" onclick="showSection('history')">μ§€μ› λ‚΄μ—­</a>
        <a href="#" onclick="showSection('settings')">μ •λ³΄ μμ •</a>
    </div>
    <div class="content">
        <div id="section-info" style="display:block;">
            <h2>νμ› μ •λ³΄</h2>
            <p>μ΄λ¦„: <span th:text="${member.name}"></span></p>
            <p>μƒλ…„μ›”μΌ: <span th:text="${member.birthDate}"></span></p>
            <p>μ „ν™”λ²νΈ: <span th:text="${member.phone}"></span></p>
            <p>μ£Όμ†: <span th:text="${member.address}"></span></p>
        </div>

        <div id="section-history" style="display:none;">
            <h2>μ§€μ› λ‚΄μ—­</h2>
            <div th:if="${#lists.isEmpty(applications)}">
                <p>μ§€μ›ν• κ³µκ³ κ°€ μ—†μµλ‹λ‹¤.</p>
            </div>
            <div th:unless="${#lists.isEmpty(applications)}">
                <table border="1" cellpadding="5" style="width:100%; text-align:center;">
                    <thead>
                    <tr>
                        <th>κ³µκ³  μ λ©</th>
                        <th>μ§€μ›μΌ</th>
                        <th>λ§κ°μΌ</th> <!-- β… μμ •λ λ¶€λ¶„ -->
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="app : ${applications}">
                        <td>
                            <a href="#" th:onclick="'showPostDetail(' + ${app.postId} + ');return false;'"
                               th:text="${app.postTitle}">κ³µκ³  μ λ©</a>
                        </td>
                        <td th:text="${#temporals.format(app.submittedAt, 'yyyy-MM-dd')}">μ§€μ›μΌ</td>
                        <td class="red-text" th:text="${#temporals.format(app.deadline, 'yyyy-MM-dd')}">λ§κ°μΌ</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div id="post-detail-box" style="display:none; margin-top:20px; border:1px solid #ccc; padding:15px;">
                <h3>π“ κ³µκ³  μƒμ„Έ</h3>
                <p><strong>μ λ©:</strong> <span id="post-title"></span></p>
                <p><strong>μ„¤λ…:</strong> <span id="post-description"></span></p>
                <p><strong>λ§κ°μΌ:</strong> <span id="post-deadline"></span></p>
                <button onclick="document.getElementById('post-detail-box').style.display='none';">λ‹«κΈ°</button>
            </div>
        </div>

        <div id="section-settings" style="display:none;">
            <h2>μ •λ³΄ μμ •</h2>
            <button onclick="location.href='/member/edit'">νμ› μ •λ³΄ μμ •</button>
            <button onclick="location.href='/member/password-change'">λΉ„λ°€λ²νΈ λ³€κ²½</button>
        </div>
    </div>
</div>

<script>
    function showSection(section) {
        document.getElementById("section-info").style.display = 'none';
        document.getElementById("section-history").style.display = 'none';
        document.getElementById("section-settings").style.display = 'none';
        document.getElementById("section-" + section).style.display = 'block';
    }

    function showPostDetail(postId) {
        fetch('/api/post/' + postId)
            .then(response => response.json())
            .then(data => {
                document.getElementById('post-title').innerText = data.title;
                document.getElementById('post-description').innerText = data.description;
                document.getElementById('post-deadline').innerText = data.deadline;
                document.getElementById('post-detail-box').style.display = 'block';
            })
            .catch(err => {
                alert("κ³µκ³  μ •λ³΄λ¥Ό λ¶λ¬μ¤μ§€ λ»ν–μµλ‹λ‹¤.");
                console.error(err);
            });
    }
</script>
</body>
</html>
